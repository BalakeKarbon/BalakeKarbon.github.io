<html lang="eng">
<head>
	<meta charset="utf-8"/>
	<title>web-portfolio</title>
</head>
<body>
	<div id='terminal-container'></div>
	<noscript>You are extra cool because whatever you are viewing this on does not support javascript!</noscript>
	<script src="/base.js"></script>
	<script>
		function adjustScale() {
			if(window.innerHeight < (window.innerWidth*0.75)) {
				document.getElementById('terminal-container').style.width=window.innerHeight*1.3333333333333333;
				document.getElementById('terminal-container').style.height=window.innerHeight;
				document.getElementById('terminal-container').style.marginLeft=((window.innerWidth-(window.innerHeight*1.3333333333333333))/2)+'px';
			} else {
				document.getElementById('terminal-container').style.width=window.innerWidth;
				document.getElementById('terminal-container').style.height=window.innerWidth*0.75;
				document.getElementById('terminal-container').style.marginLeft='0%';
			};
		}
		//I WISH I WAS WRITING IN JAVA!
		var fontSize=20;
		var terminalScreenBorder=10;
		var rows=(400-(terminalScreenBorder*2))/fontSize;
		var cols=(500-(terminalScreenBorder*2))/(fontSize/2);
		var scroll=0;
		var terminalLinks=[null]; //Setup links first then revert back to them!
		var terminalBuffer=[]; //Array of strings with the length of cols along with integer array referencing links.
		var typeRate=1;
		var terminalBusy=false;
		var terminalCanvas=document.createElement("canvas");
		var terminalContext=terminalCanvas.getContext("2d");
		terminalCanvas.width=500;
		terminalCanvas.height=400;
		terminalCanvas.style.position='absolute';
		terminalCanvas.style.top='4.1666666666666664%';
		terminalCanvas.style.left='9.375%';
		terminalCanvas.style.width='62.5%';
		terminalCanvas.style.height='66.66666666666667%';
		var depletionInterval=20;
		var depletionSize=5;
		var rrgb=[0,30,0];
		function deplete() {
			var screenImageData = terminalContext.getImageData(0,0,terminalCanvas.width,terminalCanvas.height);
		  for(var cp=0;cp<screenImageData.data.length;cp+=4) {
		    for(var cc=0;cc<3;cc++) {
		      if(screenImageData.data[cp+cc]!=rrgb[cc]) {
		      	var diff=screenImageData.data[cp+cc]-rrgb[cc];
		        if(diff>0) {
		          if(depletionSize<Math.abs(diff)) {
		          	screenImageData.data[cp+cc]-=depletionSize;
		          } else {
		          	screenImageData.data[cp+cc]-=diff;
		          }
		        } else if(diff<0) {
		        	if(depletionSize<Math.abs(diff)) {
		          	screenImageData.data[cp+cc]+=depletionSize;
		          } else {
		          	screenImageData.data[cp+cc]+=diff;
		          }
		        }
		      }
		    }
		  }
		  terminalContext.putImageData(screenImageData,0,0);
		}
		terminalContext.fillStyle = "#00FF00";
		terminalContext.fillRect(0, 0, terminalCanvas.width, terminalCanvas.height);
		setInterval(deplete,depletionInterval);
		var terminalCursor = {
			x:0,
			y:0
		};
		var terminalLines=[];
		function initTerminalLines() {
			var tli=0;
			if(terminalLines.length!=0) {
				for(tli=(terminalLines.length-1);tli>=0;tli--) {
					terminalLines[tli].remove()
					terminalLines.pop();
				}
			}
			for(tli=0;tli<rows;tli++) {
				var newLine = [];
				for(var cnc=0;cnc<cols;cnc++) {
					newLine.push(document.createElementNS('http://www.w3.org/2000/svg','text'));
					newLine[cnc].setAttribute('x',75+terminalScreenBorder+((fontSize/2)*cnc));
					newLine[cnc].setAttribute('y',25+((terminalScreenBorder+((tli)*fontSize))+fontSize));
					newLine[cnc].setAttribute('style','font-size:'+fontSize+'px;font-family:localUnifont;fill:#00FF00;fill-opacity:1;stroke:none;stroke-width:0.0');
					newLine[cnc].textContent=' ';
					document.getElementById('terminal').insertBefore(newLine[cnc],document.getElementById('terminal').firstChild);
				}
				terminalLines.push(newLine);
			}
		}
		function adjustFont(newSize) {
			fontSize=newSize;
			rows=(400-(terminalScreenBorder*2))/fontSize;
			cols=(500-(terminalScreenBorder*2))/(fontSize/2);
			terminalBuffer=[]; //Reset Buffer!
			terminalCursor.x=0;
			terminalCursor.y=0;
		}
		var lineIndex=0;
		var lineStop=0;
		function render() {
			if(terminalBuffer.length<=rows) {
				scroll=0;
			}
			lineIndex=(terminalBuffer.length-1)-scroll;
			lineStop=lineIndex-(rows-1);
			if(lineStop<0) {
				lineStop=0;
			}
			while(lineIndex>=lineStop) {
				var curText=terminalBuffer[lineIndex];
				for(var curChar=0;curChar<curText[0].length;curChar++) {
					terminalContext.fillText(curText[0][curChar],terminalScreenBorder+((fontSize/2)*curChar),(terminalScreenBorder+((lineIndex-lineStop)*fontSize))+fontSize);
					if(curText[1][curChar]!=0) {
						terminalLines[lineIndex-lineStop][curChar].onclick=terminalLinks[curText[1][curChar]];
					} else {
						terminalLines[lineIndex-lineStop][curChar].onclick=null;
					}
					terminalLines[lineIndex-lineStop][curChar].textContent=curText[0][curChar];
				}
				lineIndex--;
			}
		}
		function setChar(char,link) {
			if(terminalBusy==false) {
				terminalBusy=true;
				if(char.length>1) {
					char=char.substr(0,1);
				}
				if(terminalCursor.y>(rows-1)) {
					terminalCursor.y=(rows-1);
				} else if(terminalCursor.y<0) {
					terminalCursor.y=0;
				}
				if(terminalCursor.x>(cols-1)) {
					terminalCursor.x=(cols-1);
				} else if(terminalCursor.x<0) {
					terminalCursor.x=0;
				}
				while(terminalBuffer[terminalCursor.y]==null) {
					terminalBuffer.push(['',[]]);
				}
				for(var cbli=0;cbli<cols;cbli++) {
					terminalBuffer[terminalBuffer.length-1][1].push(0);
				}
				var offsetRow=0;
				if(terminalBuffer.length<=rows) {
					offsetRow=terminalCursor.y;
				} else {
					offsetRow=((terminalBuffer.length-1)-rows)+terminalCursor.y;
				}
				var curLine=terminalBuffer[offsetRow];
				while(curLine[0].length<=terminalCursor.x) {
					curLine[0]+=' ';
					curLine[1].push(0);
				}
				curLine[0]=curLine[0].substr(0, terminalCursor.x) + char+ curLine[0].substr(terminalCursor.x + 1);
				curLine[1][terminalCursor.x]=link;
				terminalBusy=false;
			}
		}
		function main(fileData) {
			document.getElementById('terminal-container').innerHTML=fileData.responseText;
			document.getElementById('terminal').setAttribute('width','100%');
			document.getElementById('terminal').setAttribute('height','100%');
			document.getElementById('terminal').style.zIndex='-1';
			adjustScale();
			document.getElementById('terminal-container').insertBefore(terminalCanvas,document.getElementById('terminal-container').firstChild);
			terminalCanvas.style.zIndex='-2';
			terminalContext.font=fontSize+'px localUnifont';
			terminalContext.fillStyle = '#00ff00';
			initTerminalLines();
			terminalCursor.x=Math.floor(cols/2)-1;
			terminalCursor.y=Math.floor(rows/2)-1;
			setChar('#',0);
			terminalCursor.x=Math.floor(cols/2);
			terminalCursor.y=Math.floor(rows/2)-1;
			setChar('#',0);
			terminalCursor.x=Math.floor(cols/2)-1;
			terminalCursor.y=Math.floor(rows/2);
			setChar('#',0);
			terminalCursor.x=Math.floor(cols/2);
			terminalCursor.y=Math.floor(rows/2);
			setChar('#',0);
			render();
			//Get cookie data here and load values!

		};
		loadFile("res/img/terminal.svg",null,main);
		window.addEventListener('resize',adjustScale);
	</script>
	<style>
		@font-face {
			font-family: localUnifont;
			src: url(/res/text/fonts/unifont-13.0.01.ttf);
		}
		body {
			margin: 0px 0px 0px 0px;
		}
		#terminal-container {
			position: absolute;
		}
	</style>
</body>
</html>
